/*! events-manager v1.0.4 | (c) 2014, 2015 Xavier Boubert. | MIT license */
!function(n){"use strict";if(!n.EventsManager){var t=function(){var n=!1;this.stopPropagation=function(){n=!0},this.isStoppedPropagation=function(){return n},this.resetStopPropagation=function(){n=!1}},e=function(){var n={low:-1,normal:0,high:9999999};this.formatPriority=function(t){return("undefined"==typeof t||null===t)&&(t="normal"),"string"==typeof t&&(t in n||(t="normal"),t=n[t]),t},this.sortByPriority=function(n){n.sort(function(n,t){return t.priority-n.priority})}};n.EventsManager=function(){function n(n){return n.split(",").map(function(n){return n.trim()})}function r(n){var t=null;return n=n.split("."),n.length>1?(t=n[0],n=n[1]):n=n[0],{name:n,namespace:t}}function i(n){u[n]&&console.error('EventsManager: Event "'+n+'" is locked for use')}var o=this,a=[],s=[],f=new e,u={},p=new t;this.eventsName=function(){var n=[],t=null;for(t in a)n.push(t);return n},this.eventsStack=function(n){return(a[n]||[]).concat(s)},this.fire=function(n,t){var e=[];if("undefined"!=typeof a[n]){i(n),u[n]=!0,f.sortByPriority(a[n]);for(var r=0,o=a[n].length;o>r;r++){var c=a[n][r]||!1;if(c&&(e.push(c.func.call(p,t)),p.isStoppedPropagation())){p.resetStopPropagation();break}}delete u[n]}if(s.length){f.sortByPriority(s);for(var r=0,o=s.length;o>r;r++){var c=s[r];if(e.push(c.func.call(p,n,t)),p.isStoppedPropagation()){p.resetStopPropagation();break}}}return e},this.on=function(t,e,s){return s=f.formatPriority(s),i(t),n(t).map(function(n){n=r(n),a[n.name]=a[n.name]||[],a[n.name].push({namespace:n.namespace,priority:s,func:e})}),o},this.onSafe=function(n,t,e){return o.removeEvent(n,t),o.on(n,t,e)},this.onAnything=function(n,t,e){return e=f.formatPriority(e),s.push({namespace:n,priority:e,func:t}),o},this.removeEventsNamespace=function(n){var t;for(t in a){for(var e=a[t],r=[],f=e.length-1;f>=0;f--)e[f].namespace!==n&&r.push(e[f]);r.length!==e.length&&(i(t),a[t]=r)}for(var u=[],f=s.length-1;f>=0;f--)s[f].namespace!==n&&u.push(s[f]);return u.length!==s.length&&(s=u),o},this.removeEvent=function(t,e){return i(t),n(t).map(function(n){if(n=r(n),"undefined"!=typeof a[n.name])for(var t=0,i=a[n.name].length;i>t;t++)if((!n.namespace||a[n.name][t].namespace==n.namespace)&&a[n.name][t].func.toString()==e.toString()){a[n.name].splice(t,1);break}for(var t=0,i=s.length;i>t;t++)if((!n.namespace||s[t].namespace==n.namespace)&&s[t].func.toString()==e.toString()){s.splice(t,1);break}}),o},this.removeEvents=function(){a=[],s=[]}}}}("undefined"==typeof exports?this:exports);